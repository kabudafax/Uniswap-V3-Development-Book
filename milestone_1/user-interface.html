<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ç”¨æˆ·ç•Œé¢ - Uniswap V3 Development Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A book that teaches how to build a clone of Uniswap V3 in Solidity from scratch.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Uniswap V3 å¼€å‘æ‰‹å†Œ</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 0. èƒŒæ™¯</li><li class="chapter-item expanded "><a href="../milestone_0/introduction-to-markets.html"><strong aria-hidden="true">1.</strong> å¸‚åœºä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_0/constant-function-market-maker.html"><strong aria-hidden="true">2.</strong> æ’å®šå‡½æ•°åšå¸‚å•†</a></li><li class="chapter-item expanded "><a href="../milestone_0/uniswap-v3.html"><strong aria-hidden="true">3.</strong> Uniswap V3</a></li><li class="chapter-item expanded "><a href="../milestone_0/dev-environment.html"><strong aria-hidden="true">4.</strong> å¼€å‘ç¯å¢ƒ</a></li><li class="chapter-item expanded "><a href="../milestone_0/what-we-will-build.html"><strong aria-hidden="true">5.</strong> æˆ‘ä»¬å°†è¦æ„å»ºä»€ä¹ˆ</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 1. ç¬¬ä¸€æ¬¡äº¤æ¢</li><li class="chapter-item expanded "><a href="../milestone_1/introduction.html"><strong aria-hidden="true">6.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_1/calculating-liquidity.html"><strong aria-hidden="true">7.</strong> è®¡ç®—æµåŠ¨æ€§</a></li><li class="chapter-item expanded "><a href="../milestone_1/providing-liquidity.html"><strong aria-hidden="true">8.</strong> æä¾›æµåŠ¨æ€§</a></li><li class="chapter-item expanded "><a href="../milestone_1/first-swap.html"><strong aria-hidden="true">9.</strong> ç¬¬ä¸€æ¬¡äº¤æ¢</a></li><li class="chapter-item expanded "><a href="../milestone_1/manager-contract.html"><strong aria-hidden="true">10.</strong> ç®¡ç†åˆçº¦</a></li><li class="chapter-item expanded "><a href="../milestone_1/deployment.html"><strong aria-hidden="true">11.</strong> éƒ¨ç½²</a></li><li class="chapter-item expanded "><a href="../milestone_1/user-interface.html" class="active"><strong aria-hidden="true">12.</strong> ç”¨æˆ·ç•Œé¢</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 2. ç¬¬äºŒæ¬¡äº¤æ¢</li><li class="chapter-item expanded "><a href="../milestone_2/introduction.html"><strong aria-hidden="true">13.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_2/output-amount-calculation.html"><strong aria-hidden="true">14.</strong> è¾“å‡ºé‡‘é¢è®¡ç®—</a></li><li class="chapter-item expanded "><a href="../milestone_2/math-in-solidity.html"><strong aria-hidden="true">15.</strong> Solidityä¸­çš„æ•°å­¦è¿ç®—</a></li><li class="chapter-item expanded "><a href="../milestone_2/tick-bitmap-index.html"><strong aria-hidden="true">16.</strong> Tickä½å›¾ç´¢å¼•</a></li><li class="chapter-item expanded "><a href="../milestone_2/generalize-minting.html"><strong aria-hidden="true">17.</strong> é€šç”¨é“¸é€ </a></li><li class="chapter-item expanded "><a href="../milestone_2/generalize-swapping.html"><strong aria-hidden="true">18.</strong> é€šç”¨äº¤æ¢</a></li><li class="chapter-item expanded "><a href="../milestone_2/quoter-contract.html"><strong aria-hidden="true">19.</strong> æŠ¥ä»·åˆçº¦</a></li><li class="chapter-item expanded "><a href="../milestone_2/user-interface.html"><strong aria-hidden="true">20.</strong> ç”¨æˆ·ç•Œé¢</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 3. è·¨Tickäº¤æ¢</li><li class="chapter-item expanded "><a href="../milestone_3/introduction.html"><strong aria-hidden="true">21.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_3/different-ranges.html"><strong aria-hidden="true">22.</strong> ä¸åŒä»·æ ¼èŒƒå›´</a></li><li class="chapter-item expanded "><a href="../milestone_3/cross-tick-swaps.html"><strong aria-hidden="true">23.</strong> Cross-Tick äº¤æ¢</a></li><li class="chapter-item expanded "><a href="../milestone_3/slippage-protection.html"><strong aria-hidden="true">24.</strong> æ»‘ç‚¹ä¿æŠ¤</a></li><li class="chapter-item expanded "><a href="../milestone_3/liquidity-calculation.html"><strong aria-hidden="true">25.</strong> æµåŠ¨æ€§è®¡ç®—</a></li><li class="chapter-item expanded "><a href="../milestone_3/more-on-fixed-point-numbers.html"><strong aria-hidden="true">26.</strong> å…³äºå®šç‚¹æ•°çš„æ›´å¤šå†…å®¹</a></li><li class="chapter-item expanded "><a href="../milestone_3/flash-loans.html"><strong aria-hidden="true">27.</strong> é—ªç”µè´·</a></li><li class="chapter-item expanded "><a href="../milestone_3/user-interface.html"><strong aria-hidden="true">28.</strong> ç”¨æˆ·ç•Œé¢</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 4. å¤šæ± äº¤æ¢</li><li class="chapter-item expanded "><a href="../milestone_4/introduction.html"><strong aria-hidden="true">29.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_4/factory-contract.html"><strong aria-hidden="true">30.</strong> å·¥å‚åˆçº¦</a></li><li class="chapter-item expanded "><a href="../milestone_4/path.html"><strong aria-hidden="true">31.</strong> äº¤æ¢è·¯å¾„</a></li><li class="chapter-item expanded "><a href="../milestone_4/multi-pool-swaps.html"><strong aria-hidden="true">32.</strong> å¤šæ± äº¤æ¢</a></li><li class="chapter-item expanded "><a href="../milestone_4/user-interface.html"><strong aria-hidden="true">33.</strong> ç”¨æˆ·ç•Œé¢</a></li><li class="chapter-item expanded "><a href="../milestone_4/tick-rounding.html"><strong aria-hidden="true">34.</strong> Tickèˆå…¥</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 5. è´¹ç”¨å’Œä»·æ ¼é¢„è¨€æœº</li><li class="chapter-item expanded "><a href="../milestone_5/introduction.html"><strong aria-hidden="true">35.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_5/swap-fees.html"><strong aria-hidden="true">36.</strong> äº¤æ¢è´¹ç”¨</a></li><li class="chapter-item expanded "><a href="../milestone_5/flash-loan-fees.html"><strong aria-hidden="true">37.</strong> é—ªç”µè´·è´¹ç”¨</a></li><li class="chapter-item expanded "><a href="../milestone_5/protocol-fees.html"><strong aria-hidden="true">38.</strong> åè®®è´¹ç”¨</a></li><li class="chapter-item expanded "><a href="../milestone_5/price-oracle.html"><strong aria-hidden="true">39.</strong> ä»·æ ¼é¢„è¨€æœº</a></li><li class="chapter-item expanded "><a href="../milestone_5/user-interface.html"><strong aria-hidden="true">40.</strong> ç”¨æˆ·ç•Œé¢</a></li><li class="chapter-item expanded affix "><li class="part-title">é‡Œç¨‹ç¢‘ 6: NFT å¤´å¯¸</li><li class="chapter-item expanded "><a href="../milestone_6/introduction.html"><strong aria-hidden="true">41.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../milestone_6/erc721-overview.html"><strong aria-hidden="true">42.</strong> ERC721æ¦‚è¿°</a></li><li class="chapter-item expanded "><a href="../milestone_6/nft-manager.html"><strong aria-hidden="true">43.</strong> NFTç®¡ç†å™¨</a></li><li class="chapter-item expanded "><a href="../milestone_6/nft-renderer.html"><strong aria-hidden="true">44.</strong> NFTæ¸²æŸ“å™¨</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Uniswap V3 Development Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Jeiwan/uniswapv3-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Jeiwan/uniswapv3-book/edit/main/src/milestone_1/user-interface.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="ç”¨æˆ·ç•Œé¢"><a class="header" href="#ç”¨æˆ·ç•Œé¢">ç”¨æˆ·ç•Œé¢</a></h1>
<p>æœ€å,æˆ‘ä»¬ç»ˆäºåˆ°è¾¾äº†è¿™ä¸ªé‡Œç¨‹ç¢‘çš„æœ€åä¸€ç«™â€”â€”æ„å»ºç”¨æˆ·ç•Œé¢ï¼</p>
<p><img src="images/ui.png" alt="UIåº”ç”¨ç¨‹åºçš„ç•Œé¢" /></p>
<p>ç”±äºæ„å»ºå‰ç«¯åº”ç”¨ä¸æ˜¯æœ¬ä¹¦çš„ä¸»è¦ç›®æ ‡ï¼Œæˆ‘ä¸ä¼šå±•ç¤ºå¦‚ä½•ä»å¤´å¼€å§‹æ„å»ºè¿™æ ·ä¸€ä¸ªåº”ç”¨ã€‚ç›¸åï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨MetaMaskä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚</p>
<blockquote>
<p>å¦‚æœä½ æƒ³å°è¯•è¿™ä¸ªåº”ç”¨å¹¶åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œä½ å¯ä»¥åœ¨ä»£ç ä»“åº“çš„<a href="https://github.com/Jeiwan/uniswapv3-code/tree/milestone_1/ui">ui</a>æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Reactåº”ç”¨ï¼Œè¦åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œè¯·åœ¨<code>App.js</code>ä¸­è®¾ç½®åˆçº¦åœ°å€ï¼Œç„¶åè¿è¡Œ<code>yarn start</code>ã€‚</p>
</blockquote>
<h2 id="å·¥å…·æ¦‚è¿°"><a class="header" href="#å·¥å…·æ¦‚è¿°">å·¥å…·æ¦‚è¿°</a></h2>
<h3 id="ä»€ä¹ˆæ˜¯metamask"><a class="header" href="#ä»€ä¹ˆæ˜¯metamask">ä»€ä¹ˆæ˜¯MetaMaskï¼Ÿ</a></h3>
<p>MetaMaskæ˜¯ä¸€ä¸ªä»¥æµè§ˆå™¨æ‰©å±•å½¢å¼å®ç°çš„ä»¥å¤ªåŠé’±åŒ…ã€‚å®ƒåˆ›å»ºå¹¶å­˜å‚¨ç§é’¥ï¼Œæ˜¾ç¤ºä»£å¸ä½™é¢ï¼Œå…è®¸è¿æ¥åˆ°ä¸åŒçš„ç½‘ç»œï¼Œä»¥åŠå‘é€å’Œæ¥æ”¶ä»¥å¤ªå¸å’Œä»£å¸â€”â€”ä¸€ä¸ªé’±åŒ…åº”è¯¥åšçš„æ‰€æœ‰äº‹æƒ…ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒMetaMaskè¿˜å……å½“ç­¾åè€…å’Œæä¾›è€…çš„è§’è‰²ã€‚ä½œä¸ºæä¾›è€…ï¼Œå®ƒè¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹å¹¶æä¾›ä½¿ç”¨å…¶JSON-RPC APIçš„æ¥å£ã€‚ä½œä¸ºç­¾åè€…ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå®‰å…¨äº¤æ˜“ç­¾åçš„æ¥å£ï¼Œå› æ­¤å¯ä»¥ç”¨äºä½¿ç”¨é’±åŒ…ä¸­çš„ç§é’¥ç­¾ç½²ä»»ä½•äº¤æ˜“ã€‚</p>
<p><img src="images/metamask.png" alt="MetaMaskçš„å·¥ä½œåŸç†" /></p>
<h3 id="ä¾¿åˆ©æ€§åº“"><a class="header" href="#ä¾¿åˆ©æ€§åº“">ä¾¿åˆ©æ€§åº“</a></h3>
<p>ç„¶è€Œï¼ŒMetaMaskæœ¬èº«å¹¶ä¸æä¾›å¤ªå¤šåŠŸèƒ½ï¼šå®ƒåªèƒ½ç®¡ç†è´¦æˆ·å’Œå‘é€åŸå§‹äº¤æ˜“ã€‚æˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªåº“æ¥ä½¿åˆçº¦äº¤äº’å˜å¾—å®¹æ˜“ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›æœ‰ä¸€å¥—å®ç”¨å·¥å…·ï¼Œåœ¨å¤„ç†EVMç‰¹å®šæ•°æ®ï¼ˆABIç¼–ç /è§£ç ã€å¤§æ•°å¤„ç†ç­‰ï¼‰æ—¶èƒ½è®©æˆ‘ä»¬çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚</p>
<p>æœ‰å¤šä¸ªè¿™æ ·çš„åº“ã€‚å…¶ä¸­ä¸¤ä¸ªæœ€æµè¡Œçš„æ˜¯ï¼š<a href="https://github.com/ChainSafe/web3.js">web3.js</a>å’Œ<a href="https://github.com/ethers-io/ethers.js/">ethers.js</a>ã€‚é€‰æ‹©å…¶ä¸­ä¹‹ä¸€æ˜¯ä¸ªäººåå¥½çš„é—®é¢˜ã€‚å¯¹æˆ‘æ¥è¯´ï¼ŒEthers.jsä¼¼ä¹æœ‰æ›´æ¸…æ™°çš„åˆçº¦äº¤äº’æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä¼šé€‰æ‹©å®ƒã€‚</p>
<h2 id="å·¥ä½œæµç¨‹"><a class="header" href="#å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</a></h2>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨MetaMask + Ethers.jså®ç°äº¤äº’åœºæ™¯ã€‚</p>
<h3 id="è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹"><a class="header" href="#è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹">è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹</a></h3>
<p>ä¸ºäº†å‘é€äº¤æ˜“å’Œè·å–åŒºå—é“¾æ•°æ®ï¼ŒMetaMaskéœ€è¦è¿æ¥åˆ°ä¸€ä¸ªä»¥å¤ªåŠèŠ‚ç‚¹ã€‚è¦ä¸æˆ‘ä»¬çš„åˆçº¦äº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦è¿æ¥åˆ°æœ¬åœ°AnvilèŠ‚ç‚¹ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰“å¼€MetaMaskï¼Œç‚¹å‡»ç½‘ç»œåˆ—è¡¨ï¼Œç‚¹å‡»&quot;æ·»åŠ ç½‘ç»œ&quot;ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªRPC URLä¸º<code>http://localhost:8545</code>çš„ç½‘ç»œã€‚å®ƒä¼šè‡ªåŠ¨æ£€æµ‹é“¾IDï¼ˆåœ¨Anvilçš„æƒ…å†µä¸‹æ˜¯31337ï¼‰ã€‚</p>
<p>è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹åï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„ç§é’¥ã€‚åœ¨MetaMaskä¸­ï¼Œç‚¹å‡»åœ°å€åˆ—è¡¨ï¼Œç‚¹å‡»&quot;å¯¼å…¥è´¦æˆ·&quot;ï¼Œç„¶åç²˜è´´ä½ åœ¨éƒ¨ç½²åˆçº¦å‰é€‰æ‹©çš„åœ°å€çš„ç§é’¥ã€‚ä¹‹åï¼Œè½¬åˆ°èµ„äº§åˆ—è¡¨å¹¶å¯¼å…¥ä¸¤ä¸ªä»£å¸çš„åœ°å€ã€‚ç°åœ¨ä½ åº”è¯¥èƒ½åœ¨MetaMaskä¸­çœ‹åˆ°è¿™äº›ä»£å¸çš„ä½™é¢äº†ã€‚</p>
<blockquote>
<p>MetaMaskä»ç„¶æœ‰ä¸€äº›bugã€‚æˆ‘é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“è¿æ¥åˆ°<code>localhost</code>æ—¶ï¼Œå®ƒä¼šç¼“å­˜åŒºå—é“¾çŠ¶æ€ã€‚å› æ­¤ï¼Œå½“é‡å¯èŠ‚ç‚¹æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°æ—§çš„ä»£å¸ä½™é¢å’ŒçŠ¶æ€ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·è¿›å…¥é«˜çº§è®¾ç½®å¹¶ç‚¹å‡»&quot;é‡ç½®è´¦æˆ·&quot;ã€‚æ¯æ¬¡é‡å¯èŠ‚ç‚¹åï¼Œä½ éƒ½éœ€è¦è¿™æ ·åšã€‚</p>
</blockquote>
<h3 id="è¿æ¥åˆ°metamask"><a class="header" href="#è¿æ¥åˆ°metamask">è¿æ¥åˆ°MetaMask</a></h3>
<p>å¹¶éæ¯ä¸ªç½‘ç«™éƒ½è¢«å…è®¸è®¿é—®ä½ åœ¨MetaMaskä¸­çš„åœ°å€ã€‚ç½‘ç«™é¦–å…ˆéœ€è¦è¿æ¥åˆ°MetaMaskã€‚å½“ä¸€ä¸ªæ–°ç½‘ç«™è¿æ¥åˆ°MetaMaskæ—¶ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªè¯·æ±‚æƒé™çš„çª—å£ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä»å‰ç«¯åº”ç”¨è¿æ¥åˆ°MetaMaskï¼š</p>
<pre><code class="language-js:ui/src/contexts/MetaMask.js">const connect = () =&gt; {
  if (typeof (window.ethereum) === 'undefined') {
    return setStatus('not_installed');
  }

  Promise.all([
    window.ethereum.request({ method: 'eth_requestAccounts' }),
    window.ethereum.request({ method: 'eth_chainId' }),
  ]).then(function ([accounts, chainId]) {
    setAccount(accounts[0]);
    setChain(chainId);
    setStatus('connected');
  })
    .catch(function (error) {
      console.error(error)
    });
}
</code></pre>
<p>window.ethereumæ˜¯ç”±MetaMaskæä¾›çš„å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸MetaMaské€šä¿¡çš„æ¥å£ã€‚å¦‚æœå®ƒæ˜¯undefinedï¼Œåˆ™è¡¨ç¤ºMetaMaskæœªå®‰è£…ã€‚å¦‚æœå®ƒå·²å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å‘MetaMaskå‘é€ä¸¤ä¸ªè¯·æ±‚ï¼šeth_requestAccountså’Œeth_chainIdã€‚å®é™…ä¸Šï¼Œeth_requestAccountså°†ç½‘ç«™è¿æ¥åˆ°MetaMaskã€‚å®ƒä»MetaMaskæŸ¥è¯¢åœ°å€ï¼Œè€ŒMetaMaskä¼šå‘ç”¨æˆ·è¯·æ±‚æƒé™ã€‚ç”¨æˆ·å°†èƒ½å¤Ÿé€‰æ‹©å…è®¸è®¿é—®å“ªäº›åœ°å€ã€‚</p>
<p>eth_chainIdå°†è¯¢é—®MetaMaskè¿æ¥çš„èŠ‚ç‚¹çš„é“¾IDã€‚è·å–åœ°å€å’Œé“¾IDåï¼Œæœ€å¥½åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå®ƒä»¬ï¼š</p>
<p>æä¾›æµåŠ¨æ€§
è¦å‘æ± ä¸­æä¾›æµåŠ¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªè¡¨å•ï¼Œè®©ç”¨æˆ·è¾“å…¥ä»–ä»¬æƒ³è¦å­˜å…¥çš„é‡‘é¢ã€‚ç‚¹å‡»&quot;æäº¤&quot;åï¼Œåº”ç”¨å°†æ„å»ºä¸€ä¸ªè°ƒç”¨ç®¡ç†åˆçº¦ä¸­mintå‡½æ•°çš„äº¤æ˜“ï¼Œå¹¶æä¾›ç”¨æˆ·é€‰æ‹©çš„é‡‘é¢ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>Ether.jsæä¾›äº†Contractæ¥å£æ¥ä¸åˆçº¦äº¤äº’ã€‚å®ƒä½¿æˆ‘ä»¬çš„ç”Ÿæ´»å˜å¾—æ›´åŠ è½»æ¾ï¼Œå› ä¸ºå®ƒæ‰¿æ‹…äº†ç¼–ç å‡½æ•°å‚æ•°ã€åˆ›å»ºæœ‰æ•ˆäº¤æ˜“å¹¶å°†å…¶äº¤ç»™MetaMaskçš„å·¥ä½œã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè°ƒç”¨åˆçº¦çœ‹èµ·æ¥å°±åƒåœ¨JSå¯¹è±¡ä¸Šè°ƒç”¨å¼‚æ­¥æ–¹æ³•ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºContractsçš„å®ä¾‹ï¼š</p>
<pre><code class="language-js">token0 = new ethers.Contract(
  props.config.token0Address,
  props.config.ABIs.ERC20,
  new ethers.providers.Web3Provider(window.ethereum).getSigner()
);
</code></pre>
<p>Contractå®ä¾‹æ˜¯éƒ¨ç½²åœ¨æ­¤åœ°å€çš„åˆçº¦çš„åœ°å€å’ŒABIã€‚éœ€è¦ABIæ¥ä¸åˆçº¦äº¤äº’ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯MetaMaskæä¾›çš„ç­¾åè€…æ¥å£â€”â€”JSåˆçº¦å®ä¾‹ä½¿ç”¨å®ƒé€šè¿‡MetaMaskç­¾ç½²äº¤æ˜“ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‘æ± ä¸­æ·»åŠ æµåŠ¨æ€§çš„å‡½æ•°ï¼š</p>
<pre><code class="language-js">const addLiquidity = (account, { token0, token1, manager }, { managerAddress, poolAddress }) =&gt; {
  const amount0 = ethers.utils.parseEther(&quot;0.998976618347425280&quot;);
  const amount1 = ethers.utils.parseEther(&quot;5000&quot;); // 5000 USDC
  const lowerTick = 84222;
  const upperTick = 86129;
  const liquidity = ethers.BigNumber.from(&quot;1517882343751509868544&quot;);
  const extra = ethers.utils.defaultAbiCoder.encode(
    [&quot;address&quot;, &quot;address&quot;, &quot;address&quot;],
    [token0.address, token1.address, account]
  );
  ...
</code></pre>
<p>é¦–å…ˆè¦åšçš„æ˜¯å‡†å¤‡å‚æ•°ã€‚æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰è®¡ç®—çš„ç›¸åŒå€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…è®¸ç®¡ç†åˆçº¦ä½¿ç”¨æˆ‘ä»¬çš„ä»£å¸ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥å½“å‰çš„æˆæƒé¢åº¦ï¼š</p>
<pre><code class="language-js">Promise.all(
  [
    token0.allowance(account, managerAddress),
    token1.allowance(account, managerAddress)
  ]
)
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬æ£€æŸ¥å®ƒä»¬æ˜¯å¦è¶³å¤Ÿè½¬ç§»ç›¸åº”æ•°é‡çš„ä»£å¸ã€‚å¦‚æœä¸å¤Ÿï¼Œæˆ‘ä»¬å‘é€ä¸€ä¸ªapproveäº¤æ˜“ï¼Œè¦æ±‚ç”¨æˆ·æ‰¹å‡†å‘ç®¡ç†åˆçº¦æ”¯ä»˜ç‰¹å®šæ•°é‡ã€‚ç¡®ä¿ç”¨æˆ·å·²æ‰¹å‡†å…¨é¢åï¼Œæˆ‘ä»¬è°ƒç”¨manager.mintæ¥æ·»åŠ æµåŠ¨æ€§ï¼š</p>
<pre><code class="language-js">.then(([allowance0, allowance1]) =&gt; {
  return Promise.resolve()
    .then(() =&gt; {
      if (allowance0.lt(amount0)) {
        return token0.approve(managerAddress, amount0).then(tx =&gt; tx.wait())
      }
    })
    .then(() =&gt; {
      if (allowance1.lt(amount1)) {
        return token1.approve(managerAddress, amount1).then(tx =&gt; tx.wait())
      }
    })
    .then(() =&gt; {
      return manager.mint(poolAddress, lowerTick, upperTick, liquidity, extra)
        .then(tx =&gt; tx.wait())
    })
    .then(() =&gt; {
      alert('æµåŠ¨æ€§å·²æ·»åŠ ï¼');
    });
})
</code></pre>
<blockquote>
<p><code>lt</code>æ˜¯<a href="https://docs.ethers.io/v5/api/utils/bignumber/">BigNumber</a>çš„ä¸€ä¸ªæ–¹æ³•ã€‚Ethers.jsä½¿ç”¨BigNumberæ¥è¡¨ç¤º<code>uint256</code>ç±»å‹ï¼Œå› ä¸ºJavaScript<a href="https://docs.ethers.io/v5/api/utils/bignumber/#BigNumber--notes-safenumbers">æ²¡æœ‰è¶³å¤Ÿçš„ç²¾åº¦</a>æ¥å¤„ç†è¿™ç§ç±»å‹ã€‚è¿™æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¾¿åˆ©åº“çš„åŸå› ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>è¿™ä¸æµ‹è¯•åˆçº¦éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†æˆæƒéƒ¨åˆ†ã€‚</p>
<p>ä¸Šè¿°ä»£ç ä¸­çš„<code>token0</code>ã€<code>token1</code>å’Œ<code>manager</code>æ˜¯<code>Contract</code>çš„å®ä¾‹ã€‚<code>approve</code>å’Œ<code>mint</code>æ˜¯åˆçº¦å‡½æ•°ï¼Œå®ƒä»¬æ˜¯åœ¨æˆ‘ä»¬å®ä¾‹åŒ–åˆçº¦æ—¶ä»æˆ‘ä»¬æä¾›çš„ABIåŠ¨æ€ç”Ÿæˆçš„ã€‚å½“è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶ï¼ŒEthers.jsä¼šï¼š</p>
<ol>
<li>ç¼–ç å‡½æ•°å‚æ•°ï¼›</li>
<li>æ„å»ºä¸€ä¸ªäº¤æ˜“ï¼›</li>
<li>å°†äº¤æ˜“ä¼ é€’ç»™MetaMaskå¹¶è¦æ±‚ç­¾åï¼›ç”¨æˆ·ä¼šçœ‹åˆ°ä¸€ä¸ªMetaMaskçª—å£å¹¶æŒ‰ä¸‹&quot;ç¡®è®¤&quot;ï¼›</li>
<li>å°†äº¤æ˜“å‘é€åˆ°MetaMaskè¿æ¥çš„èŠ‚ç‚¹ï¼›</li>
<li>è¿”å›ä¸€ä¸ªåŒ…å«å·²å‘é€äº¤æ˜“å®Œæ•´ä¿¡æ¯çš„äº¤æ˜“å¯¹è±¡ã€‚</li>
</ol>
<p>äº¤æ˜“å¯¹è±¡è¿˜åŒ…å«<code>wait</code>å‡½æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒæ¥ç­‰å¾…äº¤æ˜“è¢«æŒ–æ˜â€”â€”è¿™å…è®¸æˆ‘ä»¬åœ¨å‘é€å¦ä¸€ä¸ªäº¤æ˜“ä¹‹å‰ç­‰å¾…ä¸€ä¸ªäº¤æ˜“æˆåŠŸæ‰§è¡Œã€‚</p>
<blockquote>
<p>ä»¥å¤ªåŠè¦æ±‚ä¸¥æ ¼çš„äº¤æ˜“é¡ºåºã€‚è¿˜è®°å¾—nonceå—ï¼Ÿå®ƒæ˜¯è¿™ä¸ªè´¦æˆ·å‘é€çš„äº¤æ˜“çš„è´¦æˆ·èŒƒå›´å†…çš„ç´¢å¼•ã€‚æ¯ä¸ªæ–°äº¤æ˜“éƒ½ä¼šå¢åŠ è¿™ä¸ªç´¢å¼•ï¼Œä»¥å¤ªåŠä¸ä¼šæŒ–æ˜ä¸€ä¸ªäº¤æ˜“ï¼Œç›´åˆ°å‰ä¸€ä¸ªäº¤æ˜“ï¼ˆå…·æœ‰è¾ƒå°nonceçš„äº¤æ˜“ï¼‰è¢«æŒ–æ˜ã€‚</p>
</blockquote>
<h3 id="äº¤æ¢ä»£å¸"><a class="header" href="#äº¤æ¢ä»£å¸">äº¤æ¢ä»£å¸</a></h3>
<p>è¦äº¤æ¢ä»£å¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼ï¼šä»ç”¨æˆ·é‚£é‡Œè·å–å‚æ•°ï¼Œæ£€æŸ¥æˆæƒï¼Œç„¶ååœ¨ç®¡ç†å™¨ä¸Šè°ƒç”¨<code>swap</code>ã€‚</p>
<pre><code class="language-js">const swap = (amountIn, account, { tokenIn, manager, token0, token1 }, { managerAddress, poolAddress }) =&gt; {
  const amountInWei = ethers.utils.parseEther(amountIn);
  const extra = ethers.utils.defaultAbiCoder.encode(
    [&quot;address&quot;, &quot;address&quot;, &quot;address&quot;],
    [token0.address, token1.address, account]
  );

  tokenIn.allowance(account, managerAddress)
    .then((allowance) =&gt; {
      if (allowance.lt(amountInWei)) {
        return tokenIn.approve(managerAddress, amountInWei).then(tx =&gt; tx.wait())
      }
    })
    .then(() =&gt; {
      return manager.swap(poolAddress, extra).then(tx =&gt; tx.wait())
    })
    .then(() =&gt; {
      alert('äº¤æ¢æˆåŠŸï¼');
    }).catch((err) =&gt; {
      console.error(err);
      alert('å¤±è´¥ï¼');
    });
}
</code></pre>
<p>è¿™é‡Œå”¯ä¸€çš„æ–°ä¸œè¥¿æ˜¯<code>ethers.utils.parseEther()</code>å‡½æ•°ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å°†æ•°å­—è½¬æ¢ä¸ºweiï¼Œä»¥å¤ªåŠä¸­çš„æœ€å°å•ä½ã€‚</p>
<p>è®¢é˜…å˜æ›´</p>
<h3 id="è®¢é˜…å˜æ›´"><a class="header" href="#è®¢é˜…å˜æ›´">è®¢é˜…å˜æ›´</a></h3>
<p>å¯¹äºå»ä¸­å¿ƒåŒ–åº”ç”¨æ¥è¯´ï¼Œåæ˜ å½“å‰åŒºå—é“¾çŠ¶æ€æ˜¯å¾ˆé‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å½“å‰æ± å‚¨å¤‡æ­£ç¡®è®¡ç®—äº¤æ¢ä»·æ ¼è‡³å…³é‡è¦ï¼›è¿‡æ—¶çš„æ•°æ®å¯èƒ½å¯¼è‡´æ»‘ç‚¹å¹¶ä½¿äº¤æ¢äº¤æ˜“å¤±è´¥ã€‚</p>
<p>åœ¨å¼€å‘æ± åˆçº¦æ—¶ï¼Œæˆ‘ä»¬äº†è§£äº†äº‹ä»¶ï¼Œå®ƒä»¬å……å½“åŒºå—é“¾æ•°æ®ç´¢å¼•ï¼šæ¯å½“æ™ºèƒ½åˆçº¦çŠ¶æ€è¢«ä¿®æ”¹æ—¶ï¼Œæœ€å¥½å‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œå› ä¸ºäº‹ä»¶è¢«ç´¢å¼•ä»¥ä¾¿å¿«é€Ÿæœç´¢ã€‚ç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯è®¢é˜…åˆçº¦äº‹ä»¶ä»¥ä¿æŒæˆ‘ä»¬çš„å‰ç«¯åº”ç”¨æ›´æ–°ã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªäº‹ä»¶æºï¼</p>
<p>è¦è®¢é˜…äº‹ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>on(EVENT_NAME, handler)</code>å‡½æ•°ã€‚å›è°ƒå‡½æ•°æ¥æ”¶äº‹ä»¶çš„æ‰€æœ‰å­—æ®µå’Œäº‹ä»¶æœ¬èº«ä½œä¸ºå‚æ•°ï¼š</p>
<pre><code class="language-js">const subscribeToEvents = (pool, callback) =&gt; {
  pool.on(&quot;Mint&quot;, (sender, owner, tickLower, tickUpper, amount, amount0, amount1, event) =&gt; callback(event));
  pool.on(&quot;Swap&quot;, (sender, recipient, amount0, amount1, sqrtPriceX96, liquidity, tick, event) =&gt; callback(event));
}
</code></pre>
<p>è¦è¿‡æ»¤å’Œè·å–ä»¥å‰çš„äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š<code>queryFilter</code>:</p>
<pre><code class="language-js">Promise.all([
  pool.queryFilter(&quot;Mint&quot;, &quot;earliest&quot;, &quot;latest&quot;),
  pool.queryFilter(&quot;Swap&quot;, &quot;earliest&quot;, &quot;latest&quot;),
]).then(([mints, swaps]) =&gt; {
  ...
});
</code></pre>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°ä¸€äº›äº‹ä»¶å­—æ®µè¢«æ ‡è®°ä¸ºindexedâ€”â€”è¿™äº›å­—æ®µç”±ä»¥å¤ªåŠèŠ‚ç‚¹ç´¢å¼•ï¼Œè¿™å…è®¸é€šè¿‡è¿™äº›å­—æ®µä¸­çš„ç‰¹å®šå€¼æœç´¢äº‹ä»¶ã€‚ä¾‹å¦‚ï¼ŒSwapäº‹ä»¶æœ‰senderå’Œrecipientå­—æ®µè¢«ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡äº¤æ¢å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œæœç´¢ã€‚åŒæ ·ï¼ŒEthers.jsä½¿è¿™å˜å¾—æ›´å®¹æ˜“ï¼š</p>
<pre><code class="language-js">const swapFilter = pool.filters.Swap(sender, recipient);
const swaps = await pool.queryFilter(swapFilter, fromBlock, toBlock);
</code></pre>
<hr />
<p>å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å®Œæˆäº†é‡Œç¨‹ç¢‘1ï¼</p>
<p style="font-size:3rem; text-align: center">
ğŸ‰ğŸ¾ğŸ¾ğŸ¾ğŸ‰
</p>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../milestone_1/deployment.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../milestone_2/introduction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../milestone_1/deployment.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../milestone_2/introduction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
